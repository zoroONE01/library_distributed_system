{
    "swagger": "2.0",
    "info": {
        "description": "This is a distributed library management system with horizontal fragmentation and full replication",
        "title": "Distributed Library Management System API - Site Q1",
        "termsOfService": "N/A",
        "contact": {
            "name": "API Support",
            "email": "dev@library.com"
        },
        "license": {
            "name": "MIT",
            "url": "https://opensource.org/licenses/MIT"
        },
        "version": "1.0"
    },
    "host": "localhost:8081",
    "basePath": "/",
    "paths": {
        "/api/coordinator/transfer-book": {
            "post": {
                "description": "Transfer a book copy from one site to another using distributed transaction coordination",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Coordinator"
                ],
                "summary": "Transfer book between sites using 2PC",
                "parameters": [
                    {
                        "description": "Book transfer request",
                        "name": "request",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/main.TransferBookRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Book transferred successfully",
                        "schema": {
                            "$ref": "#/definitions/models.TransferBookResponse"
                        }
                    },
                    "400": {
                        "description": "Invalid request format",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "500": {
                        "description": "Failed to transfer book",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    }
                }
            }
        },
        "/api/manager/books": {
            "post": {
                "security": [
                    {
                        "BearerAuth": []
                    }
                ],
                "description": "Create a new book in the catalog using 2-Phase Commit (Manager only)",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Manager"
                ],
                "summary": "Create new book (2PC)",
                "parameters": [
                    {
                        "description": "Book information",
                        "name": "book",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/models.Sach"
                        }
                    }
                ],
                "responses": {
                    "201": {
                        "description": "Book created successfully",
                        "schema": {
                            "$ref": "#/definitions/models.SuccessResponse"
                        }
                    },
                    "400": {
                        "description": "Invalid request body",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "401": {
                        "description": "Unauthorized",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "403": {
                        "description": "Access denied - Manager only",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "409": {
                        "description": "Book already exists",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "500": {
                        "description": "Internal server error",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    }
                }
            }
        },
        "/api/manager/books/search": {
            "get": {
                "security": [
                    {
                        "BearerAuth": []
                    }
                ],
                "description": "Search for available books across all sites (Manager only)",
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Manager"
                ],
                "summary": "Search available books system-wide",
                "parameters": [
                    {
                        "type": "string",
                        "description": "Book title search term",
                        "name": "tenSach",
                        "in": "query"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Search results",
                        "schema": {
                            "allOf": [
                                {
                                    "$ref": "#/definitions/models.SuccessResponse"
                                },
                                {
                                    "type": "object",
                                    "properties": {
                                        "data": {
                                            "type": "array",
                                            "items": {
                                                "$ref": "#/definitions/models.BookSearchResult"
                                            }
                                        }
                                    }
                                }
                            ]
                        }
                    },
                    "400": {
                        "description": "Missing search parameters",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "401": {
                        "description": "Unauthorized",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "403": {
                        "description": "Access denied - Manager only",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "500": {
                        "description": "Internal server error",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    }
                }
            }
        },
        "/api/manager/books/{isbn}": {
            "get": {
                "security": [
                    {
                        "BearerAuth": []
                    }
                ],
                "description": "Get book information by ISBN (Manager only)",
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Manager"
                ],
                "summary": "Get book by ISBN",
                "parameters": [
                    {
                        "type": "string",
                        "description": "Book ISBN",
                        "name": "isbn",
                        "in": "path",
                        "required": true
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Book found",
                        "schema": {
                            "allOf": [
                                {
                                    "$ref": "#/definitions/models.SuccessResponse"
                                },
                                {
                                    "type": "object",
                                    "properties": {
                                        "data": {
                                            "$ref": "#/definitions/models.Sach"
                                        }
                                    }
                                }
                            ]
                        }
                    },
                    "401": {
                        "description": "Unauthorized",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "403": {
                        "description": "Access denied - Manager only",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "404": {
                        "description": "Book not found",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "500": {
                        "description": "Internal server error",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    }
                }
            }
        },
        "/api/manager/readers": {
            "get": {
                "security": [
                    {
                        "BearerAuth": []
                    }
                ],
                "description": "Get all readers from all sites in the distributed system (Manager only)",
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Readers"
                ],
                "summary": "Get all readers system-wide",
                "parameters": [
                    {
                        "type": "string",
                        "description": "Search term for reader name",
                        "name": "search",
                        "in": "query"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Readers retrieved successfully",
                        "schema": {
                            "allOf": [
                                {
                                    "$ref": "#/definitions/models.SuccessResponse"
                                },
                                {
                                    "type": "object",
                                    "properties": {
                                        "data": {
                                            "type": "array",
                                            "items": {
                                                "$ref": "#/definitions/models.DocGia"
                                            }
                                        }
                                    }
                                }
                            ]
                        }
                    },
                    "401": {
                        "description": "Unauthorized",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "403": {
                        "description": "Access denied - Manager only",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "500": {
                        "description": "Internal server error",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    }
                }
            }
        },
        "/api/manager/statistics": {
            "get": {
                "security": [
                    {
                        "BearerAuth": []
                    }
                ],
                "description": "Get comprehensive statistics from all sites in the distributed system (Manager only)",
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Manager"
                ],
                "summary": "Get system-wide statistics",
                "responses": {
                    "200": {
                        "description": "Statistics retrieved successfully",
                        "schema": {
                            "allOf": [
                                {
                                    "$ref": "#/definitions/models.SuccessResponse"
                                },
                                {
                                    "type": "object",
                                    "properties": {
                                        "data": {
                                            "$ref": "#/definitions/models.SystemStats"
                                        }
                                    }
                                }
                            ]
                        }
                    },
                    "401": {
                        "description": "Unauthorized",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "403": {
                        "description": "Access denied - Manager only",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "500": {
                        "description": "Internal server error",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    }
                }
            }
        },
        "/api/manager/stats": {
            "get": {
                "security": [
                    {
                        "BearerAuth": []
                    }
                ],
                "description": "Get comprehensive statistics across all sites in the distributed system (Manager only)",
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Statistics"
                ],
                "summary": "Get system statistics",
                "responses": {
                    "200": {
                        "description": "System statistics retrieved successfully",
                        "schema": {
                            "allOf": [
                                {
                                    "$ref": "#/definitions/models.SuccessResponse"
                                },
                                {
                                    "type": "object",
                                    "properties": {
                                        "data": {
                                            "$ref": "#/definitions/models.SystemStats"
                                        }
                                    }
                                }
                            ]
                        }
                    },
                    "401": {
                        "description": "Unauthorized",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "403": {
                        "description": "Manager role required",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "500": {
                        "description": "Failed to retrieve system statistics",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    }
                }
            }
        },
        "/api/site/{siteID}/book-copies": {
            "get": {
                "security": [
                    {
                        "BearerAuth": []
                    }
                ],
                "description": "Get all book copies available at the current site (fragmented data)",
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Books"
                ],
                "summary": "Get book copies at site",
                "responses": {
                    "200": {
                        "description": "Book copies retrieved successfully",
                        "schema": {
                            "allOf": [
                                {
                                    "$ref": "#/definitions/models.SuccessResponse"
                                },
                                {
                                    "type": "object",
                                    "properties": {
                                        "data": {
                                            "type": "array",
                                            "items": {
                                                "$ref": "#/definitions/models.BookCopyResponse"
                                            }
                                        }
                                    }
                                }
                            ]
                        }
                    },
                    "401": {
                        "description": "Unauthorized",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "403": {
                        "description": "Access denied to this site",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "500": {
                        "description": "Internal server error",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    }
                }
            },
            "post": {
                "security": [
                    {
                        "BearerAuth": []
                    }
                ],
                "description": "Create a new book copy at the current site (ThuThu only)",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Book Copies"
                ],
                "summary": "Create new book copy",
                "parameters": [
                    {
                        "description": "Book copy information",
                        "name": "bookCopy",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/models.QuyenSach"
                        }
                    }
                ],
                "responses": {
                    "201": {
                        "description": "Book copy created successfully",
                        "schema": {
                            "$ref": "#/definitions/models.SuccessResponse"
                        }
                    },
                    "400": {
                        "description": "Invalid request body",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "401": {
                        "description": "Unauthorized",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "403": {
                        "description": "Access denied - ThuThu only",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "409": {
                        "description": "Book copy already exists",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "500": {
                        "description": "Internal server error",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    }
                }
            }
        },
        "/api/site/{siteID}/book-copies/{maQuyenSach}": {
            "get": {
                "security": [
                    {
                        "BearerAuth": []
                    }
                ],
                "description": "Get book copy information by ID",
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Book Copies"
                ],
                "summary": "Get book copy by ID",
                "parameters": [
                    {
                        "type": "string",
                        "description": "Book copy ID",
                        "name": "maQuyenSach",
                        "in": "path",
                        "required": true
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Book copy found",
                        "schema": {
                            "allOf": [
                                {
                                    "$ref": "#/definitions/models.SuccessResponse"
                                },
                                {
                                    "type": "object",
                                    "properties": {
                                        "data": {
                                            "$ref": "#/definitions/models.QuyenSach"
                                        }
                                    }
                                }
                            ]
                        }
                    },
                    "401": {
                        "description": "Unauthorized",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "404": {
                        "description": "Book copy not found",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "500": {
                        "description": "Internal server error",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    }
                }
            },
            "put": {
                "security": [
                    {
                        "BearerAuth": []
                    }
                ],
                "description": "Update book copy information (ThuThu only)",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Book Copies"
                ],
                "summary": "Update book copy",
                "parameters": [
                    {
                        "type": "string",
                        "description": "Book copy ID",
                        "name": "maQuyenSach",
                        "in": "path",
                        "required": true
                    },
                    {
                        "description": "Updated book copy information",
                        "name": "bookCopy",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/models.QuyenSach"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Book copy updated successfully",
                        "schema": {
                            "$ref": "#/definitions/models.SuccessResponse"
                        }
                    },
                    "400": {
                        "description": "Invalid request body",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "401": {
                        "description": "Unauthorized",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "403": {
                        "description": "Access denied - ThuThu only",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "404": {
                        "description": "Book copy not found",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "500": {
                        "description": "Internal server error",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    }
                }
            },
            "delete": {
                "security": [
                    {
                        "BearerAuth": []
                    }
                ],
                "description": "Delete a book copy (ThuThu only)",
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Book Copies"
                ],
                "summary": "Delete book copy",
                "parameters": [
                    {
                        "type": "string",
                        "description": "Book copy ID",
                        "name": "maQuyenSach",
                        "in": "path",
                        "required": true
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Book copy deleted successfully",
                        "schema": {
                            "$ref": "#/definitions/models.SuccessResponse"
                        }
                    },
                    "401": {
                        "description": "Unauthorized",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "403": {
                        "description": "Access denied - ThuThu only",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "404": {
                        "description": "Book copy not found",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "409": {
                        "description": "Cannot delete book copy currently on loan",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "500": {
                        "description": "Internal server error",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    }
                }
            }
        },
        "/api/site/{siteID}/books": {
            "get": {
                "security": [
                    {
                        "BearerAuth": []
                    }
                ],
                "description": "Get all books available in the library system (replicated data)",
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Books"
                ],
                "summary": "Get all books",
                "responses": {
                    "200": {
                        "description": "Books retrieved successfully",
                        "schema": {
                            "allOf": [
                                {
                                    "$ref": "#/definitions/models.SuccessResponse"
                                },
                                {
                                    "type": "object",
                                    "properties": {
                                        "data": {
                                            "type": "array",
                                            "items": {
                                                "$ref": "#/definitions/models.Sach"
                                            }
                                        }
                                    }
                                }
                            ]
                        }
                    },
                    "401": {
                        "description": "Unauthorized",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "500": {
                        "description": "Internal server error",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    }
                }
            }
        },
        "/api/site/{siteID}/books/{isbn}": {
            "get": {
                "security": [
                    {
                        "BearerAuth": []
                    }
                ],
                "description": "Get detailed information about a specific book by its ISBN",
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Books"
                ],
                "summary": "Get book by ISBN",
                "parameters": [
                    {
                        "type": "string",
                        "description": "Book ISBN",
                        "name": "isbn",
                        "in": "path",
                        "required": true
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Book found",
                        "schema": {
                            "allOf": [
                                {
                                    "$ref": "#/definitions/models.SuccessResponse"
                                },
                                {
                                    "type": "object",
                                    "properties": {
                                        "data": {
                                            "$ref": "#/definitions/models.Sach"
                                        }
                                    }
                                }
                            ]
                        }
                    },
                    "400": {
                        "description": "Invalid ISBN parameter",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "401": {
                        "description": "Unauthorized",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "404": {
                        "description": "Book not found",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    }
                }
            }
        },
        "/api/site/{siteID}/books/{isbn}/available": {
            "get": {
                "security": [
                    {
                        "BearerAuth": []
                    }
                ],
                "description": "Get an available copy of a book at the current site",
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Books"
                ],
                "summary": "Get available book copy",
                "parameters": [
                    {
                        "type": "string",
                        "description": "Book ISBN",
                        "name": "isbn",
                        "in": "path",
                        "required": true
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Available copy found",
                        "schema": {
                            "allOf": [
                                {
                                    "$ref": "#/definitions/models.SuccessResponse"
                                },
                                {
                                    "type": "object",
                                    "properties": {
                                        "data": {
                                            "$ref": "#/definitions/models.BookCopyResponse"
                                        }
                                    }
                                }
                            ]
                        }
                    },
                    "400": {
                        "description": "Invalid ISBN parameter",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "401": {
                        "description": "Unauthorized",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "404": {
                        "description": "No available copy found",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    }
                }
            }
        },
        "/api/site/{siteID}/borrow": {
            "post": {
                "security": [
                    {
                        "BearerAuth": []
                    }
                ],
                "description": "Create a new book borrowing transaction (Librarian only)",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Borrowing"
                ],
                "summary": "Create borrow transaction",
                "parameters": [
                    {
                        "description": "Borrow request details",
                        "name": "request",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/models.CreateBorrowRequest"
                        }
                    }
                ],
                "responses": {
                    "201": {
                        "description": "Borrow record created successfully",
                        "schema": {
                            "allOf": [
                                {
                                    "$ref": "#/definitions/models.SuccessResponse"
                                },
                                {
                                    "type": "object",
                                    "properties": {
                                        "data": {
                                            "$ref": "#/definitions/models.BorrowResponse"
                                        }
                                    }
                                }
                            ]
                        }
                    },
                    "400": {
                        "description": "Invalid request format",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "401": {
                        "description": "Unauthorized",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "403": {
                        "description": "Access denied to this site",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "500": {
                        "description": "Failed to create borrow record",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    }
                }
            }
        },
        "/api/site/{siteID}/borrows": {
            "get": {
                "security": [
                    {
                        "BearerAuth": []
                    }
                ],
                "description": "Get all borrow records for the current site (Librarian only)",
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Borrowing"
                ],
                "summary": "Get borrow records",
                "responses": {
                    "200": {
                        "description": "Borrow records retrieved successfully",
                        "schema": {
                            "allOf": [
                                {
                                    "$ref": "#/definitions/models.SuccessResponse"
                                },
                                {
                                    "type": "object",
                                    "properties": {
                                        "data": {
                                            "type": "array",
                                            "items": {
                                                "$ref": "#/definitions/models.BorrowResponse"
                                            }
                                        }
                                    }
                                }
                            ]
                        }
                    },
                    "401": {
                        "description": "Unauthorized",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "403": {
                        "description": "Access denied to this site",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "500": {
                        "description": "Failed to retrieve borrow records",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    }
                }
            }
        },
        "/api/site/{siteID}/readers": {
            "get": {
                "security": [
                    {
                        "BearerAuth": []
                    }
                ],
                "description": "Get all readers registered at the current site",
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Readers"
                ],
                "summary": "Get all readers at site",
                "parameters": [
                    {
                        "type": "string",
                        "description": "Search term for reader name",
                        "name": "search",
                        "in": "query"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Readers retrieved successfully",
                        "schema": {
                            "allOf": [
                                {
                                    "$ref": "#/definitions/models.SuccessResponse"
                                },
                                {
                                    "type": "object",
                                    "properties": {
                                        "data": {
                                            "type": "array",
                                            "items": {
                                                "$ref": "#/definitions/models.DocGia"
                                            }
                                        }
                                    }
                                }
                            ]
                        }
                    },
                    "401": {
                        "description": "Unauthorized",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "500": {
                        "description": "Internal server error",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    }
                }
            },
            "post": {
                "security": [
                    {
                        "BearerAuth": []
                    }
                ],
                "description": "Create a new reader at the current site (ThuThu only)",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Readers"
                ],
                "summary": "Create new reader",
                "parameters": [
                    {
                        "description": "Reader information",
                        "name": "reader",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/models.DocGia"
                        }
                    }
                ],
                "responses": {
                    "201": {
                        "description": "Reader created successfully",
                        "schema": {
                            "$ref": "#/definitions/models.SuccessResponse"
                        }
                    },
                    "400": {
                        "description": "Invalid request body",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "401": {
                        "description": "Unauthorized",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "403": {
                        "description": "Access denied - ThuThu only",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "409": {
                        "description": "Reader already exists",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "500": {
                        "description": "Internal server error",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    }
                }
            }
        },
        "/api/site/{siteID}/readers/{maDG}": {
            "get": {
                "security": [
                    {
                        "BearerAuth": []
                    }
                ],
                "description": "Get reader information by ID",
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Readers"
                ],
                "summary": "Get reader by ID",
                "parameters": [
                    {
                        "type": "string",
                        "description": "Reader ID",
                        "name": "maDG",
                        "in": "path",
                        "required": true
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Reader found",
                        "schema": {
                            "allOf": [
                                {
                                    "$ref": "#/definitions/models.SuccessResponse"
                                },
                                {
                                    "type": "object",
                                    "properties": {
                                        "data": {
                                            "$ref": "#/definitions/models.DocGia"
                                        }
                                    }
                                }
                            ]
                        }
                    },
                    "401": {
                        "description": "Unauthorized",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "404": {
                        "description": "Reader not found",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "500": {
                        "description": "Internal server error",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    }
                }
            },
            "put": {
                "security": [
                    {
                        "BearerAuth": []
                    }
                ],
                "description": "Update reader information (ThuThu only)",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Readers"
                ],
                "summary": "Update reader",
                "parameters": [
                    {
                        "type": "string",
                        "description": "Reader ID",
                        "name": "maDG",
                        "in": "path",
                        "required": true
                    },
                    {
                        "description": "Updated reader information",
                        "name": "reader",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/models.DocGia"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Reader updated successfully",
                        "schema": {
                            "$ref": "#/definitions/models.SuccessResponse"
                        }
                    },
                    "400": {
                        "description": "Invalid request body",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "401": {
                        "description": "Unauthorized",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "403": {
                        "description": "Access denied - ThuThu only",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "404": {
                        "description": "Reader not found",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "500": {
                        "description": "Internal server error",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    }
                }
            },
            "delete": {
                "security": [
                    {
                        "BearerAuth": []
                    }
                ],
                "description": "Delete a reader (ThuThu only)",
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Readers"
                ],
                "summary": "Delete reader",
                "parameters": [
                    {
                        "type": "string",
                        "description": "Reader ID",
                        "name": "maDG",
                        "in": "path",
                        "required": true
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Reader deleted successfully",
                        "schema": {
                            "$ref": "#/definitions/models.SuccessResponse"
                        }
                    },
                    "401": {
                        "description": "Unauthorized",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "403": {
                        "description": "Access denied - ThuThu only",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "404": {
                        "description": "Reader not found",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "409": {
                        "description": "Cannot delete reader with active borrows",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "500": {
                        "description": "Internal server error",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    }
                }
            }
        },
        "/api/site/{siteID}/return/{id}": {
            "put": {
                "security": [
                    {
                        "BearerAuth": []
                    }
                ],
                "description": "Return a borrowed book and update its status (Librarian only)",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Borrowing"
                ],
                "summary": "Return borrowed book",
                "parameters": [
                    {
                        "type": "integer",
                        "description": "Borrow transaction ID",
                        "name": "id",
                        "in": "path",
                        "required": true
                    },
                    {
                        "description": "Return details (optional)",
                        "name": "request",
                        "in": "body",
                        "schema": {
                            "$ref": "#/definitions/models.ReturnBookRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Book returned successfully",
                        "schema": {
                            "$ref": "#/definitions/models.SuccessResponse"
                        }
                    },
                    "400": {
                        "description": "Invalid borrow ID format",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "401": {
                        "description": "Unauthorized",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "403": {
                        "description": "Access denied to this site",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "500": {
                        "description": "Failed to return book",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    }
                }
            }
        },
        "/auth/debug": {
            "get": {
                "description": "Check JWT secret configuration for debugging token issues",
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Authentication"
                ],
                "summary": "Debug JWT configuration",
                "responses": {
                    "200": {
                        "description": "JWT configuration info",
                        "schema": {
                            "type": "object",
                            "additionalProperties": {
                                "type": "string"
                            }
                        }
                    }
                }
            }
        },
        "/auth/login": {
            "post": {
                "description": "Authenticate user using stored procedure and return JWT access token only",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Authentication"
                ],
                "summary": "User login",
                "parameters": [
                    {
                        "description": "Login credentials",
                        "name": "credentials",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/auth.LoginRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Login successful with access token",
                        "schema": {
                            "$ref": "#/definitions/auth.LoginResponse"
                        }
                    },
                    "400": {
                        "description": "Invalid request format",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "401": {
                        "description": "Invalid credentials",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "500": {
                        "description": "Internal server error",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    }
                }
            }
        },
        "/auth/logout": {
            "post": {
                "security": [
                    {
                        "BearerAuth": []
                    }
                ],
                "description": "Logout user (invalidate token on client side)",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Authentication"
                ],
                "summary": "User logout",
                "responses": {
                    "200": {
                        "description": "Logout successful",
                        "schema": {
                            "type": "object",
                            "additionalProperties": {
                                "type": "string"
                            }
                        }
                    },
                    "401": {
                        "description": "Unauthorized",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    }
                }
            }
        },
        "/auth/profile": {
            "get": {
                "security": [
                    {
                        "BearerAuth": []
                    }
                ],
                "description": "Get detailed information about the currently authenticated user including role, branch, and permissions",
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Authentication"
                ],
                "summary": "Get current user profile",
                "responses": {
                    "200": {
                        "description": "User profile information",
                        "schema": {
                            "$ref": "#/definitions/models.UserInfo"
                        }
                    },
                    "401": {
                        "description": "Unauthorized",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "500": {
                        "description": "Internal server error",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    }
                }
            }
        }
    },
    "definitions": {
        "auth.LoginRequest": {
            "description": "User login credentials",
            "type": "object",
            "required": [
                "password",
                "username"
            ],
            "properties": {
                "password": {
                    "description": "Password",
                    "type": "string",
                    "example": "password123"
                },
                "username": {
                    "description": "Username",
                    "type": "string",
                    "example": "thuthu01"
                }
            }
        },
        "auth.LoginResponse": {
            "description": "Successful login response with JWT access token only",
            "type": "object",
            "properties": {
                "accessToken": {
                    "description": "JWT access token",
                    "type": "string",
                    "example": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                }
            }
        },
        "main.TransferBookRequest": {
            "type": "object",
            "required": [
                "fromSite",
                "maQuyenSach",
                "toSite"
            ],
            "properties": {
                "fromSite": {
                    "description": "Source site ID",
                    "type": "string",
                    "example": "Q1"
                },
                "maQuyenSach": {
                    "description": "Book copy ID to transfer",
                    "type": "string",
                    "example": "QS001"
                },
                "toSite": {
                    "description": "Destination site ID",
                    "type": "string",
                    "example": "Q3"
                }
            }
        },
        "models.BookCopyResponse": {
            "description": "Book copy information with book details",
            "type": "object",
            "properties": {
                "quyenSach": {
                    "description": "Book copy information",
                    "allOf": [
                        {
                            "$ref": "#/definitions/models.QuyenSach"
                        }
                    ]
                },
                "sach": {
                    "description": "Book information",
                    "allOf": [
                        {
                            "$ref": "#/definitions/models.Sach"
                        }
                    ]
                }
            }
        },
        "models.BookSearchResult": {
            "description": "Book search result with availability across branches",
            "type": "object",
            "properties": {
                "chiNhanh": {
                    "description": "Available branches",
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/models.ChiNhanh"
                    }
                },
                "sach": {
                    "description": "Book information",
                    "allOf": [
                        {
                            "$ref": "#/definitions/models.Sach"
                        }
                    ]
                },
                "soLuongCo": {
                    "description": "Total available copies",
                    "type": "integer",
                    "example": 5
                }
            }
        },
        "models.BorrowResponse": {
            "description": "Borrow transaction with related information",
            "type": "object",
            "properties": {
                "docGia": {
                    "description": "Reader information",
                    "allOf": [
                        {
                            "$ref": "#/definitions/models.DocGia"
                        }
                    ]
                },
                "phieuMuon": {
                    "description": "Borrow transaction",
                    "allOf": [
                        {
                            "$ref": "#/definitions/models.PhieuMuon"
                        }
                    ]
                },
                "sach": {
                    "description": "Book information",
                    "allOf": [
                        {
                            "$ref": "#/definitions/models.Sach"
                        }
                    ]
                }
            }
        },
        "models.ChiNhanh": {
            "description": "Branch information (fully replicated across all sites)",
            "type": "object",
            "required": [
                "maCN",
                "tenCN"
            ],
            "properties": {
                "diaChi": {
                    "description": "Branch address",
                    "type": "string",
                    "example": "123 Nguyn Hu, Q1, TP.HCM"
                },
                "maCN": {
                    "description": "Branch code",
                    "type": "string",
                    "example": "Q1"
                },
                "tenCN": {
                    "description": "Branch name",
                    "type": "string",
                    "example": "Th Vin Qun 1"
                }
            }
        },
        "models.CreateBorrowRequest": {
            "description": "Request payload for creating a borrow transaction",
            "type": "object",
            "required": [
                "maDG",
                "maQuyenSach"
            ],
            "properties": {
                "maDG": {
                    "description": "Reader ID",
                    "type": "string",
                    "example": "DG001"
                },
                "maQuyenSach": {
                    "description": "Book copy ID",
                    "type": "string",
                    "example": "QS001"
                }
            }
        },
        "models.DocGia": {
            "description": "Reader information (fragmented by registration branch)",
            "type": "object",
            "required": [
                "hoTen",
                "maCNDangKy",
                "maDG"
            ],
            "properties": {
                "hoTen": {
                    "description": "Reader name",
                    "type": "string",
                    "example": "Nguyn Vn B"
                },
                "maCNDangKy": {
                    "description": "Registration branch",
                    "type": "string",
                    "example": "Q1"
                },
                "maDG": {
                    "description": "Reader ID",
                    "type": "string",
                    "example": "DG001"
                }
            }
        },
        "models.ErrorResponse": {
            "description": "Generic error response",
            "type": "object",
            "properties": {
                "details": {
                    "description": "Error details (optional)"
                },
                "error": {
                    "description": "Error message",
                    "type": "string",
                    "example": "Bad Request"
                }
            }
        },
        "models.PhieuMuon": {
            "description": "Borrow transaction (fragmented by branch)",
            "type": "object",
            "required": [
                "maCN",
                "maDG",
                "maQuyenSach"
            ],
            "properties": {
                "maCN": {
                    "description": "Branch code",
                    "type": "string",
                    "example": "Q1"
                },
                "maDG": {
                    "description": "Reader ID",
                    "type": "string",
                    "example": "DG001"
                },
                "maPM": {
                    "description": "Borrow ID (auto-generated)",
                    "type": "integer",
                    "example": 1
                },
                "maQuyenSach": {
                    "description": "Book copy ID",
                    "type": "string",
                    "example": "QS001"
                },
                "ngayMuon": {
                    "description": "Borrow date",
                    "type": "string",
                    "example": "2025-01-15T10:00:00Z"
                },
                "ngayTra": {
                    "description": "Return date (null if not returned)",
                    "type": "string",
                    "example": "2025-01-20T14:00:00Z"
                }
            }
        },
        "models.QuyenSach": {
            "description": "Book copy information (fragmented by branch)",
            "type": "object",
            "required": [
                "isbn",
                "maCN",
                "maQuyenSach"
            ],
            "properties": {
                "isbn": {
                    "description": "Book ISBN",
                    "type": "string",
                    "example": "978-0-123456-78-9"
                },
                "maCN": {
                    "description": "Branch code",
                    "type": "string",
                    "example": "Q1"
                },
                "maQuyenSach": {
                    "description": "Book copy ID",
                    "type": "string",
                    "example": "QS001"
                },
                "tinhTrang": {
                    "description": "Book status",
                    "type": "string",
                    "enum": [
                        "C sn",
                        "ang mn",
                        "B hng"
                    ],
                    "example": "C sn"
                }
            }
        },
        "models.ReturnBookRequest": {
            "description": "Request payload for returning a borrowed book",
            "type": "object",
            "properties": {
                "maQuyenSach": {
                    "description": "Book copy ID (optional)",
                    "type": "string",
                    "example": "QS001"
                },
                "ngayTra": {
                    "description": "Return date",
                    "type": "string",
                    "example": "2025-01-20T14:00:00Z"
                }
            }
        },
        "models.Sach": {
            "description": "Book information (fully replicated across all sites)",
            "type": "object",
            "required": [
                "isbn",
                "tenSach"
            ],
            "properties": {
                "isbn": {
                    "description": "Book ISBN",
                    "type": "string",
                    "example": "978-0-123456-78-9"
                },
                "tacGia": {
                    "description": "Author name",
                    "type": "string",
                    "example": "Nguyn Vn A"
                },
                "tenSach": {
                    "description": "Book title",
                    "type": "string",
                    "example": "Lp trnh Go"
                }
            }
        },
        "models.SiteStats": {
            "description": "Site-specific statistics",
            "type": "object",
            "properties": {
                "booksOnLoan": {
                    "description": "Books currently on loan",
                    "type": "integer",
                    "example": 75
                },
                "siteID": {
                    "description": "Site identifier",
                    "type": "string",
                    "example": "Q1"
                },
                "totalBooks": {
                    "description": "Total books in this site",
                    "type": "integer",
                    "example": 500
                },
                "totalReaders": {
                    "description": "Total registered readers",
                    "type": "integer",
                    "example": 200
                }
            }
        },
        "models.SuccessResponse": {
            "description": "Generic success response",
            "type": "object",
            "properties": {
                "data": {
                    "description": "Response data (optional)"
                },
                "message": {
                    "description": "Success message",
                    "type": "string",
                    "example": "Operation completed successfully"
                },
                "success": {
                    "description": "Operation success status",
                    "type": "boolean",
                    "example": true
                }
            }
        },
        "models.SystemStats": {
            "description": "Distributed system statistics",
            "type": "object",
            "properties": {
                "statsBySite": {
                    "description": "Statistics by site",
                    "type": "object",
                    "additionalProperties": {
                        "$ref": "#/definitions/models.SiteStats"
                    }
                },
                "totalBooksOnLoan": {
                    "description": "Total books on loan across all sites",
                    "type": "integer",
                    "example": 150
                }
            }
        },
        "models.TransferBookResponse": {
            "description": "Response after successful book transfer using 2PC protocol",
            "type": "object",
            "properties": {
                "coordinator": {
                    "description": "Coordinator service",
                    "type": "string",
                    "example": "Distributed Transaction Coordinator"
                },
                "fromSite": {
                    "description": "Source site ID",
                    "type": "string",
                    "example": "Q1"
                },
                "maQuyenSach": {
                    "description": "Transferred book copy ID",
                    "type": "string",
                    "example": "QS001"
                },
                "message": {
                    "description": "Success message",
                    "type": "string",
                    "example": "Book transferred successfully using 2PC protocol"
                },
                "protocol": {
                    "description": "Protocol used",
                    "type": "string",
                    "example": "Two-Phase Commit (2PC)"
                },
                "toSite": {
                    "description": "Destination site ID",
                    "type": "string",
                    "example": "Q3"
                }
            }
        },
        "models.UserInfo": {
            "description": "Detailed user information including permissions",
            "type": "object",
            "required": [
                "username"
            ],
            "properties": {
                "id": {
                    "description": "User ID",
                    "type": "string",
                    "example": "user123"
                },
                "maCN": {
                    "description": "Branch code (for THUTHU)",
                    "type": "string",
                    "example": "Q1"
                },
                "permissions": {
                    "description": "User permissions",
                    "type": "string",
                    "example": "SELECT,INSERT,UPDATE,EXECUTE"
                },
                "role": {
                    "description": "User role",
                    "type": "string",
                    "enum": [
                        "THUTHU",
                        "QUANLY"
                    ],
                    "example": "THUTHU"
                },
                "username": {
                    "description": "Username",
                    "type": "string",
                    "example": "ThuThu_Q1"
                }
            }
        }
    },
    "securityDefinitions": {
        "BearerAuth": {
            "description": "Type \"Bearer\" followed by a space and JWT token.",
            "type": "apiKey",
            "name": "Authorization",
            "in": "header"
        }
    }
}