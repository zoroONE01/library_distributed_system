basePath: /
definitions:
  auth.LoginRequest:
    description: User login credentials
    properties:
      password:
        description: Password
        example: password123
        type: string
      username:
        description: Username
        example: thuthu01
        type: string
    required:
    - password
    - username
    type: object
  auth.LoginResponse:
    description: Successful login response with JWT access token only
    properties:
      accessToken:
        description: JWT access token
        example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        type: string
    type: object
  main.TransferBookRequest:
    properties:
      fromSite:
        description: Source site ID
        example: Q1
        type: string
      maQuyenSach:
        description: Book copy ID to transfer
        example: QS001
        type: string
      toSite:
        description: Destination site ID
        example: Q3
        type: string
    required:
    - fromSite
    - maQuyenSach
    - toSite
    type: object
  models.BookCopyResponse:
    description: Book copy information with book details
    properties:
      quyenSach:
        allOf:
        - $ref: '#/definitions/models.QuyenSach'
        description: Book copy information
      sach:
        allOf:
        - $ref: '#/definitions/models.Sach'
        description: Book information
    type: object
  models.BookSearchResult:
    description: Book search result with availability across branches
    properties:
      chiNhanh:
        description: Available branches
        items:
          $ref: '#/definitions/models.ChiNhanh'
        type: array
      sach:
        allOf:
        - $ref: '#/definitions/models.Sach'
        description: Book information
      soLuongCo:
        description: Total available copies
        example: 5
        type: integer
    type: object
  models.BorrowResponse:
    description: Borrow transaction with related information
    properties:
      docGia:
        allOf:
        - $ref: '#/definitions/models.DocGia'
        description: Reader information
      phieuMuon:
        allOf:
        - $ref: '#/definitions/models.PhieuMuon'
        description: Borrow transaction
      sach:
        allOf:
        - $ref: '#/definitions/models.Sach'
        description: Book information
    type: object
  models.ChiNhanh:
    description: Branch information (fully replicated across all sites)
    properties:
      diaChi:
        description: Branch address
        example: 123 Nguyễn Huệ, Q1, TP.HCM
        type: string
      maCN:
        description: Branch code
        example: Q1
        type: string
      tenCN:
        description: Branch name
        example: Thư Viện Quận 1
        type: string
    required:
    - maCN
    - tenCN
    type: object
  models.CreateBorrowRequest:
    description: Request payload for creating a borrow transaction
    properties:
      maDG:
        description: Reader ID
        example: DG001
        type: string
      maQuyenSach:
        description: Book copy ID
        example: QS001
        type: string
    required:
    - maDG
    - maQuyenSach
    type: object
  models.DocGia:
    description: Reader information (fragmented by registration branch)
    properties:
      hoTen:
        description: Reader name
        example: Nguyễn Văn B
        type: string
      maCNDangKy:
        description: Registration branch
        example: Q1
        type: string
      maDG:
        description: Reader ID
        example: DG001
        type: string
    required:
    - hoTen
    - maCNDangKy
    - maDG
    type: object
  models.ErrorResponse:
    description: Generic error response
    properties:
      details:
        description: Error details (optional)
      error:
        description: Error message
        example: Bad Request
        type: string
    type: object
  models.PhieuMuon:
    description: Borrow transaction (fragmented by branch)
    properties:
      maCN:
        description: Branch code
        example: Q1
        type: string
      maDG:
        description: Reader ID
        example: DG001
        type: string
      maPM:
        description: Borrow ID (auto-generated)
        example: 1
        type: integer
      maQuyenSach:
        description: Book copy ID
        example: QS001
        type: string
      ngayMuon:
        description: Borrow date
        example: "2025-01-15T10:00:00Z"
        type: string
      ngayTra:
        description: Return date (null if not returned)
        example: "2025-01-20T14:00:00Z"
        type: string
    required:
    - maCN
    - maDG
    - maQuyenSach
    type: object
  models.QuyenSach:
    description: Book copy information (fragmented by branch)
    properties:
      isbn:
        description: Book ISBN
        example: 978-0-123456-78-9
        type: string
      maCN:
        description: Branch code
        example: Q1
        type: string
      maQuyenSach:
        description: Book copy ID
        example: QS001
        type: string
      tinhTrang:
        description: Book status
        enum:
        - Có sẵn
        - Đang mượn
        - Bị hỏng
        example: Có sẵn
        type: string
    required:
    - isbn
    - maCN
    - maQuyenSach
    type: object
  models.ReaderInfoResponse:
    description: Reader information with borrow history
    properties:
      docGia:
        allOf:
        - $ref: '#/definitions/models.DocGia'
        description: Reader information
      phieuMuons:
        description: Borrow history
        items:
          $ref: '#/definitions/models.PhieuMuon'
        type: array
    type: object
  models.ReturnBookRequest:
    description: Request payload for returning a borrowed book
    properties:
      maQuyenSach:
        description: Book copy ID (optional)
        example: QS001
        type: string
      ngayTra:
        description: Return date
        example: "2025-01-20T14:00:00Z"
        type: string
    type: object
  models.Sach:
    description: Book information (fully replicated across all sites)
    properties:
      isbn:
        description: Book ISBN
        example: 978-0-123456-78-9
        type: string
      tacGia:
        description: Author name
        example: Nguyễn Văn A
        type: string
      tenSach:
        description: Book title
        example: Lập trình Go
        type: string
    required:
    - isbn
    - tenSach
    type: object
  models.SiteStats:
    description: Site-specific statistics
    properties:
      booksOnLoan:
        description: Books currently on loan
        example: 75
        type: integer
      siteID:
        description: Site identifier
        example: Q1
        type: string
      totalBooks:
        description: Total books in this site
        example: 500
        type: integer
      totalReaders:
        description: Total registered readers
        example: 200
        type: integer
    type: object
  models.SuccessResponse:
    description: Generic success response
    properties:
      data:
        description: Response data (optional)
      message:
        description: Success message
        example: Operation completed successfully
        type: string
      success:
        description: Operation success status
        example: true
        type: boolean
    type: object
  models.SystemStats:
    description: Distributed system statistics
    properties:
      statsBySite:
        additionalProperties:
          $ref: '#/definitions/models.SiteStats'
        description: Statistics by site
        type: object
      totalBooksOnLoan:
        description: Total books on loan across all sites
        example: 150
        type: integer
    type: object
  models.TransferBookResponse:
    description: Response after successful book transfer using 2PC protocol
    properties:
      coordinator:
        description: Coordinator service
        example: Distributed Transaction Coordinator
        type: string
      fromSite:
        description: Source site ID
        example: Q1
        type: string
      maQuyenSach:
        description: Transferred book copy ID
        example: QS001
        type: string
      message:
        description: Success message
        example: Book transferred successfully using 2PC protocol
        type: string
      protocol:
        description: Protocol used
        example: Two-Phase Commit (2PC)
        type: string
      toSite:
        description: Destination site ID
        example: Q3
        type: string
    type: object
  models.UserInfo:
    description: Detailed user information including permissions
    properties:
      id:
        description: User ID
        example: user123
        type: string
      maCN:
        description: Branch code (for THUTHU)
        example: Q1
        type: string
      permissions:
        description: User permissions
        example: SELECT,INSERT,UPDATE,EXECUTE
        type: string
      role:
        description: User role
        enum:
        - THUTHU
        - QUANLY
        example: THUTHU
        type: string
      username:
        description: Username
        example: ThuThu_Q1
        type: string
    required:
    - username
    type: object
host: localhost:8081
info:
  contact:
    email: dev@library.com
    name: API Support
  description: This is a distributed library management system with horizontal fragmentation
    and full replication
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
  termsOfService: N/A
  title: Distributed Library Management System API - Site Q1
  version: "1.0"
paths:
  /api/coordinator/transfer-book:
    post:
      consumes:
      - application/json
      description: Transfer a book copy from one site to another using distributed
        transaction coordination
      parameters:
      - description: Book transfer request
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/main.TransferBookRequest'
      produces:
      - application/json
      responses:
        "200":
          description: Book transferred successfully
          schema:
            $ref: '#/definitions/models.TransferBookResponse'
        "400":
          description: Invalid request format
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Failed to transfer book
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Transfer book between sites using 2PC
      tags:
      - Coordinator
  /api/manager/books/search:
    get:
      description: Search for books across all sites in the distributed system (Manager
        only)
      parameters:
      - description: Book title search term
        in: query
        name: tenSach
        type: string
      - description: Author search term
        in: query
        name: tacGia
        type: string
      - description: ISBN search term
        in: query
        name: isbn
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Search results
          schema:
            allOf:
            - $ref: '#/definitions/models.SuccessResponse'
            - properties:
                data:
                  items:
                    $ref: '#/definitions/models.BookSearchResult'
                  type: array
              type: object
        "400":
          description: Missing search parameters
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "403":
          description: Manager role required
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Search books system-wide
      tags:
      - Books
  /api/manager/stats:
    get:
      description: Get comprehensive statistics across all sites in the distributed
        system (Manager only)
      produces:
      - application/json
      responses:
        "200":
          description: System statistics retrieved successfully
          schema:
            allOf:
            - $ref: '#/definitions/models.SuccessResponse'
            - properties:
                data:
                  $ref: '#/definitions/models.SystemStats'
              type: object
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "403":
          description: Manager role required
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Failed to retrieve system statistics
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Get system statistics
      tags:
      - Statistics
  /api/site/{siteID}/book-copies:
    get:
      description: Get all book copies available at the current site (fragmented data)
      produces:
      - application/json
      responses:
        "200":
          description: Book copies retrieved successfully
          schema:
            allOf:
            - $ref: '#/definitions/models.SuccessResponse'
            - properties:
                data:
                  items:
                    $ref: '#/definitions/models.BookCopyResponse'
                  type: array
              type: object
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "403":
          description: Access denied to this site
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Get book copies at site
      tags:
      - Books
  /api/site/{siteID}/books:
    get:
      description: Get all books available in the library system (replicated data)
      produces:
      - application/json
      responses:
        "200":
          description: Books retrieved successfully
          schema:
            allOf:
            - $ref: '#/definitions/models.SuccessResponse'
            - properties:
                data:
                  items:
                    $ref: '#/definitions/models.Sach'
                  type: array
              type: object
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Get all books
      tags:
      - Books
  /api/site/{siteID}/books/{isbn}:
    get:
      description: Get detailed information about a specific book by its ISBN
      parameters:
      - description: Book ISBN
        in: path
        name: isbn
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Book found
          schema:
            allOf:
            - $ref: '#/definitions/models.SuccessResponse'
            - properties:
                data:
                  $ref: '#/definitions/models.Sach'
              type: object
        "400":
          description: Invalid ISBN parameter
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "404":
          description: Book not found
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Get book by ISBN
      tags:
      - Books
  /api/site/{siteID}/books/{isbn}/available:
    get:
      description: Get an available copy of a book at the current site
      parameters:
      - description: Book ISBN
        in: path
        name: isbn
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Available copy found
          schema:
            allOf:
            - $ref: '#/definitions/models.SuccessResponse'
            - properties:
                data:
                  $ref: '#/definitions/models.BookCopyResponse'
              type: object
        "400":
          description: Invalid ISBN parameter
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "404":
          description: No available copy found
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Get available book copy
      tags:
      - Books
  /api/site/{siteID}/borrow:
    post:
      consumes:
      - application/json
      description: Create a new book borrowing transaction (Librarian only)
      parameters:
      - description: Borrow request details
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/models.CreateBorrowRequest'
      produces:
      - application/json
      responses:
        "201":
          description: Borrow record created successfully
          schema:
            allOf:
            - $ref: '#/definitions/models.SuccessResponse'
            - properties:
                data:
                  $ref: '#/definitions/models.BorrowResponse'
              type: object
        "400":
          description: Invalid request format
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "403":
          description: Access denied to this site
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Failed to create borrow record
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Create borrow transaction
      tags:
      - Borrowing
  /api/site/{siteID}/borrows:
    get:
      description: Get all borrow records for the current site (Librarian only)
      produces:
      - application/json
      responses:
        "200":
          description: Borrow records retrieved successfully
          schema:
            allOf:
            - $ref: '#/definitions/models.SuccessResponse'
            - properties:
                data:
                  items:
                    $ref: '#/definitions/models.BorrowResponse'
                  type: array
              type: object
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "403":
          description: Access denied to this site
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Failed to retrieve borrow records
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Get borrow records
      tags:
      - Borrowing
  /api/site/{siteID}/readers/{maDG}:
    get:
      description: Get detailed information about a reader at the current site
      parameters:
      - description: Reader ID
        in: path
        name: maDG
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Reader information retrieved successfully
          schema:
            allOf:
            - $ref: '#/definitions/models.SuccessResponse'
            - properties:
                data:
                  $ref: '#/definitions/models.ReaderInfoResponse'
              type: object
        "400":
          description: Reader ID is required
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "403":
          description: Access denied to this site
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "404":
          description: Reader not found at this site
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Get reader information
      tags:
      - Readers
  /api/site/{siteID}/return/{id}:
    put:
      consumes:
      - application/json
      description: Return a borrowed book and update its status (Librarian only)
      parameters:
      - description: Borrow transaction ID
        in: path
        name: id
        required: true
        type: integer
      - description: Return details (optional)
        in: body
        name: request
        schema:
          $ref: '#/definitions/models.ReturnBookRequest'
      produces:
      - application/json
      responses:
        "200":
          description: Book returned successfully
          schema:
            $ref: '#/definitions/models.SuccessResponse'
        "400":
          description: Invalid borrow ID format
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "403":
          description: Access denied to this site
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Failed to return book
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Return borrowed book
      tags:
      - Borrowing
  /auth/login:
    post:
      consumes:
      - application/json
      description: Authenticate user using stored procedure and return JWT access
        token only
      parameters:
      - description: Login credentials
        in: body
        name: credentials
        required: true
        schema:
          $ref: '#/definitions/auth.LoginRequest'
      produces:
      - application/json
      responses:
        "200":
          description: Login successful with access token
          schema:
            $ref: '#/definitions/auth.LoginResponse'
        "400":
          description: Invalid request format
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "401":
          description: Invalid credentials
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: User login
      tags:
      - Authentication
  /auth/logout:
    post:
      consumes:
      - application/json
      description: Logout user (invalidate token on client side)
      produces:
      - application/json
      responses:
        "200":
          description: Logout successful
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      security:
      - BearerAuth: []
      summary: User logout
      tags:
      - Authentication
  /auth/profile:
    get:
      description: Get detailed information about the currently authenticated user
        including role, branch, and permissions
      produces:
      - application/json
      responses:
        "200":
          description: User profile information
          schema:
            $ref: '#/definitions/models.UserInfo'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Get current user profile
      tags:
      - Authentication
securityDefinitions:
  BearerAuth:
    description: Type "Bearer" followed by a space and JWT token.
    in: header
    name: Authorization
    type: apiKey
swagger: "2.0"
