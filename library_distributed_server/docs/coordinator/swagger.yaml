basePath: /
definitions:
  auth.LoginRequest:
    description: User login credentials
    properties:
      password:
        description: Password
        example: password123
        type: string
      username:
        description: Username
        example: thuthu01
        type: string
    required:
    - password
    - username
    type: object
  auth.LoginResponse:
    description: Successful login response with JWT access token only
    properties:
      accessToken:
        description: JWT access token
        example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        type: string
    type: object
  main.TransferBookRequest:
    properties:
      fromSite:
        description: Source site ID
        example: Q1
        type: string
      maQuyenSach:
        description: Book copy ID to transfer
        example: QS001
        type: string
      toSite:
        description: Destination site ID
        example: Q3
        type: string
    required:
    - fromSite
    - maQuyenSach
    - toSite
    type: object
  models.BookWithAvailability:
    description: Book information combined with availability count for client applications
    properties:
      availableCount:
        description: Available copies count
        example: 5
        type: integer
      borrowedCount:
        description: Currently borrowed count
        example: 5
        type: integer
      isbn:
        description: Book ISBN (ID)
        example: 978-0-123456-78-9
        type: string
      tacGia:
        description: Author name
        example: Nguyễn Văn A
        type: string
      tenSach:
        description: Book title
        example: Lập trình Go
        type: string
      totalCount:
        description: Total copies count
        example: 10
        type: integer
    type: object
  models.CreateBorrowRequest:
    description: Request payload for creating a borrow transaction
    properties:
      maDG:
        description: Reader ID
        example: DG001
        type: string
      maQuyenSach:
        description: Book copy ID
        example: QS001
        type: string
    required:
    - maDG
    - maQuyenSach
    type: object
  models.DocGia:
    description: Reader information (fragmented by registration branch)
    properties:
      hoTen:
        description: Reader name
        example: Nguyễn Văn B
        type: string
      maCNDangKy:
        description: Registration branch
        example: Q1
        type: string
      maDG:
        description: Reader ID
        example: DG001
        type: string
    required:
    - hoTen
    - maCNDangKy
    - maDG
    type: object
  models.ErrorResponse:
    description: Generic error response
    properties:
      details:
        description: Error details (optional)
      error:
        description: Error message
        example: Bad Request
        type: string
    type: object
  models.ListResponse:
    description: Generic paginated list response matching Flutter BookListModel structure
    properties:
      items:
        description: List of items (matches Flutter items field)
      paging:
        allOf:
        - $ref: '#/definitions/models.PagingInfo'
        description: Pagination info (matches Flutter paging field)
    type: object
  models.PagingInfo:
    description: Pagination information matching Flutter PagingModel structure
    properties:
      page:
        description: Current page number (0-based, matches Flutter)
        example: 0
        type: integer
      size:
        description: Items per page (matches Flutter)
        example: 20
        type: integer
      totalPages:
        description: Total number of pages (matches Flutter)
        example: 10
        type: integer
    type: object
  models.QuyenSach:
    description: Book copy information (fragmented by branch)
    properties:
      isbn:
        description: Book ISBN
        example: 978-0-123456-78-9
        type: string
      maCN:
        description: Branch code
        example: Q1
        type: string
      maQuyenSach:
        description: Book copy ID
        example: QS001
        type: string
      tinhTrang:
        description: Book status
        enum:
        - Có sẵn
        - Đang mượn
        - Bị hỏng
        example: Có sẵn
        type: string
    required:
    - isbn
    - maCN
    - maQuyenSach
    type: object
  models.ReturnBookRequest:
    description: Request payload for returning a borrowed book
    properties:
      maQuyenSach:
        description: Book copy ID (optional)
        example: QS001
        type: string
      ngayTra:
        description: Return date
        example: "2025-01-20T14:00:00Z"
        type: string
    type: object
  models.Sach:
    description: Book information (fully replicated across all sites)
    properties:
      isbn:
        description: Book ISBN
        example: 978-0-123456-78-9
        type: string
      tacGia:
        description: Author name
        example: Nguyễn Văn A
        type: string
      tenSach:
        description: Book title
        example: Lập trình Go
        type: string
    required:
    - isbn
    - tenSach
    type: object
  models.SiteStats:
    description: Site-specific statistics
    properties:
      booksOnLoan:
        description: Books currently on loan
        example: 75
        type: integer
      siteID:
        description: Site identifier
        example: Q1
        type: string
      totalBooks:
        description: Total books in this site
        example: 500
        type: integer
      totalReaders:
        description: Total registered readers
        example: 200
        type: integer
    type: object
  models.SuccessResponse:
    description: Generic success response
    properties:
      data:
        description: Response data (optional)
      message:
        description: Success message
        example: Operation completed successfully
        type: string
      success:
        description: Operation success status
        example: true
        type: boolean
    type: object
  models.SystemStatsResponse:
    description: Comprehensive system statistics across all sites
    properties:
      activeBorrows:
        description: Currently borrowed books
        example: 500
        type: integer
      generatedAt:
        description: Stats generation time
        example: "2025-01-15T10:00:00Z"
        type: string
      overdueBooks:
        description: Overdue books
        example: 50
        type: integer
      popularBooks:
        description: Most borrowed books
        items:
          $ref: '#/definitions/models.BookWithAvailability'
        type: array
      siteStats:
        description: Per-site statistics
        items:
          $ref: '#/definitions/models.SiteStats'
        type: array
      totalBooks:
        description: Total books in catalog
        example: 1000
        type: integer
      totalCopies:
        description: Total book copies
        example: 5000
        type: integer
      totalReaders:
        description: Total registered readers
        example: 2000
        type: integer
    type: object
  models.TransferBookRequest:
    description: Request payload for transferring a book copy between sites using
      2PC protocol
    properties:
      fromSite:
        description: Source site ID
        example: Q1
        type: string
      maQuyenSach:
        description: Book copy ID to transfer
        example: QS001
        type: string
      toSite:
        description: Destination site ID
        example: Q3
        type: string
    required:
    - fromSite
    - maQuyenSach
    - toSite
    type: object
  models.TransferBookResponse:
    description: Response after successful book transfer using 2PC protocol
    properties:
      coordinator:
        description: Coordinator service
        example: Distributed Transaction Coordinator
        type: string
      fromSite:
        description: Source site ID
        example: Q1
        type: string
      maQuyenSach:
        description: Transferred book copy ID
        example: QS001
        type: string
      message:
        description: Success message
        example: Book transferred successfully using 2PC protocol
        type: string
      protocol:
        description: Protocol used
        example: Two-Phase Commit (2PC)
        type: string
      toSite:
        description: Destination site ID
        example: Q3
        type: string
    type: object
  models.UserInfo:
    description: Detailed user information including permissions
    properties:
      id:
        description: User ID
        example: user123
        type: string
      maCN:
        description: Branch code (for THUTHU)
        example: Q1
        type: string
      permissions:
        description: User permissions
        example: SELECT,INSERT,UPDATE,EXECUTE
        type: string
      role:
        description: User role
        enum:
        - THUTHU
        - QUANLY
        example: THUTHU
        type: string
      username:
        description: Username
        example: ThuThu_Q1
        type: string
    required:
    - username
    type: object
host: localhost:8080
info:
  contact:
    email: dev@library.com
    name: API Support
  description: Coordinator service for distributed transactions in the library management
    system
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
  termsOfService: N/A
  title: Distributed Transaction Coordinator API
  version: "1.0"
paths:
  /auth/login:
    post:
      consumes:
      - application/json
      description: Authenticate user using stored procedure and return JWT access
        token only
      parameters:
      - description: Login credentials
        in: body
        name: credentials
        required: true
        schema:
          $ref: '#/definitions/auth.LoginRequest'
      produces:
      - application/json
      responses:
        "200":
          description: Login successful with access token
          schema:
            $ref: '#/definitions/auth.LoginResponse'
        "400":
          description: Invalid request format
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "401":
          description: Invalid credentials
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: User login
      tags:
      - Authentication
  /auth/logout:
    post:
      consumes:
      - application/json
      description: Logout user (invalidate token on client side)
      produces:
      - application/json
      responses:
        "200":
          description: Logout successful
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      security:
      - BearerAuth: []
      summary: User logout
      tags:
      - Authentication
  /auth/profile:
    get:
      description: Get detailed information about the currently authenticated user
        including role, branch, and permissions
      produces:
      - application/json
      responses:
        "200":
          description: User profile information
          schema:
            $ref: '#/definitions/models.UserInfo'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Get current user profile
      tags:
      - Authentication
  /book-copies:
    get:
      description: Retrieve book copies for the current site
      parameters:
      - description: Page number (0-based, default 0)
        in: query
        name: page
        type: integer
      - description: Page size (default 20)
        in: query
        name: size
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: List of book copies
          schema:
            $ref: '#/definitions/models.ListResponse'
        "500":
          description: Failed to retrieve book copies
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Get book copies
      tags:
      - Book Copies
    post:
      consumes:
      - application/json
      description: Create a new book copy at the current site
      parameters:
      - description: Book copy information
        in: body
        name: bookCopy
        required: true
        schema:
          $ref: '#/definitions/models.QuyenSach'
      produces:
      - application/json
      responses:
        "201":
          description: Book copy created
          schema:
            $ref: '#/definitions/models.SuccessResponse'
        "400":
          description: Invalid request
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Failed to create book copy
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Create book copy
      tags:
      - Book Copies
  /book-copies/{maQuyenSach}:
    delete:
      description: Delete a book copy
      parameters:
      - description: Book copy ID
        in: path
        name: maQuyenSach
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Book copy deleted
          schema:
            $ref: '#/definitions/models.SuccessResponse'
        "404":
          description: Book copy not found
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Failed to delete book copy
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Delete book copy
      tags:
      - Book Copies
    get:
      description: Get detailed information about a book copy
      parameters:
      - description: Book copy ID
        in: path
        name: maQuyenSach
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Book copy details
          schema:
            $ref: '#/definitions/models.SuccessResponse'
        "404":
          description: Book copy not found
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Failed to retrieve book copy
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Get book copy by ID
      tags:
      - Book Copies
    put:
      consumes:
      - application/json
      description: Update book copy information
      parameters:
      - description: Book copy ID
        in: path
        name: maQuyenSach
        required: true
        type: string
      - description: Updated book copy information
        in: body
        name: bookCopy
        required: true
        schema:
          $ref: '#/definitions/models.QuyenSach'
      produces:
      - application/json
      responses:
        "200":
          description: Book copy updated
          schema:
            $ref: '#/definitions/models.SuccessResponse'
        "400":
          description: Invalid request
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "404":
          description: Book copy not found
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Failed to update book copy
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Update book copy
      tags:
      - Book Copies
  /books:
    get:
      description: Retrieve all books in the catalog
      parameters:
      - description: Page number (0-based, default 0)
        in: query
        name: page
        type: integer
      - description: Page size (default 20)
        in: query
        name: size
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: List of books
          schema:
            $ref: '#/definitions/models.ListResponse'
        "500":
          description: Failed to retrieve books
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Get all books
      tags:
      - Books
  /books/{isbn}:
    get:
      description: Get detailed information about a book by its ISBN
      parameters:
      - description: Book ISBN
        in: path
        name: isbn
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Book details
          schema:
            $ref: '#/definitions/models.SuccessResponse'
        "404":
          description: Book not found
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Failed to retrieve book
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Get book by ISBN
      tags:
      - Books
  /books/{isbn}/available:
    get:
      description: Check if a book is available at the current site
      parameters:
      - description: Book ISBN
        in: path
        name: isbn
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Availability info
          schema:
            $ref: '#/definitions/models.SuccessResponse'
        "404":
          description: No available copies
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Failed to check availability
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Check book availability
      tags:
      - Books
  /books/search:
    get:
      description: Search for books across all sites with availability info
      parameters:
      - description: Search query
        in: query
        name: query
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Search results
          schema:
            $ref: '#/definitions/models.SuccessResponse'
        "400":
          description: Invalid query
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Search failed
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Search books across all sites
      tags:
      - Books
  /borrow:
    get:
      description: Retrieve borrow transactions with role-based filtering
      parameters:
      - description: Page number (0-based, default 0)
        in: query
        name: page
        type: integer
      - description: Page size (default 20)
        in: query
        name: size
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: List of borrow transactions
          schema:
            $ref: '#/definitions/models.ListResponse'
        "500":
          description: Failed to retrieve borrows
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Get borrow transactions
      tags:
      - Borrowing
    post:
      consumes:
      - application/json
      description: Create a new book borrowing transaction (Librarian only)
      parameters:
      - description: Borrow request
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/models.CreateBorrowRequest'
      produces:
      - application/json
      responses:
        "201":
          description: Borrow created successfully
          schema:
            $ref: '#/definitions/models.SuccessResponse'
        "400":
          description: Invalid request format
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Failed to create borrow
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Create borrow transaction
      tags:
      - Borrowing
  /borrow/detailed:
    get:
      description: Get borrow records with book and reader details for Flutter app
      parameters:
      - description: Page number (0-based, default 0)
        in: query
        name: page
        type: integer
      - description: Page size (default 20)
        in: query
        name: size
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: List of detailed borrow records
          schema:
            $ref: '#/definitions/models.ListResponse'
        "500":
          description: Failed to retrieve borrow records
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Get detailed borrow records
      tags:
      - Borrowing
  /borrow/history/{maDG}:
    get:
      description: Get borrowing history for a specific reader
      parameters:
      - description: Reader ID
        in: path
        name: maDG
        required: true
        type: string
      - description: Page number (0-based, default 0)
        in: query
        name: page
        type: integer
      - description: Page size (default 20)
        in: query
        name: size
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: Reader's borrow history
          schema:
            $ref: '#/definitions/models.ListResponse'
        "500":
          description: Failed to retrieve borrow history
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Get borrow history for a reader
      tags:
      - Borrowing
  /borrow/overdue:
    get:
      description: Get list of overdue books for the site
      produces:
      - application/json
      responses:
        "200":
          description: List of overdue books
          schema:
            $ref: '#/definitions/models.SuccessResponse'
        "500":
          description: Failed to retrieve overdue books
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Get overdue books
      tags:
      - Borrowing
  /borrow/return/{id}:
    put:
      consumes:
      - application/json
      description: Process book return transaction (Librarian only)
      parameters:
      - description: Book copy ID
        in: path
        name: id
        required: true
        type: string
      - description: Return request
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/models.ReturnBookRequest'
      produces:
      - application/json
      responses:
        "200":
          description: Book returned successfully
          schema:
            $ref: '#/definitions/models.SuccessResponse'
        "400":
          description: Invalid request
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Failed to return book
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Return borrowed book
      tags:
      - Borrowing
  /borrow/statistics:
    get:
      description: Get borrowing statistics for the site
      produces:
      - application/json
      responses:
        "200":
          description: Borrowing statistics
          schema:
            $ref: '#/definitions/models.SuccessResponse'
        "500":
          description: Failed to retrieve statistics
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Get borrowing statistics
      tags:
      - Borrowing
  /coordinator/transfer-book:
    post:
      consumes:
      - application/json
      description: Transfer a book copy from one site to another using distributed
        transaction coordination
      parameters:
      - description: Book transfer request
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/main.TransferBookRequest'
      produces:
      - application/json
      responses:
        "200":
          description: Book transferred successfully
          schema:
            $ref: '#/definitions/models.TransferBookResponse'
        "400":
          description: Invalid request format
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Failed to transfer book
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Transfer book between sites using 2PC
      tags:
      - Coordinator
  /manager/books:
    post:
      consumes:
      - application/json
      description: Create a new book in the system catalog using 2PC protocol (Manager
        only)
      parameters:
      - description: Book information
        in: body
        name: book
        required: true
        schema:
          $ref: '#/definitions/models.Sach'
      produces:
      - application/json
      responses:
        "201":
          description: Book created successfully
          schema:
            $ref: '#/definitions/models.SuccessResponse'
        "400":
          description: Invalid request format
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Failed to create book
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Create book in catalog
      tags:
      - Manager
  /manager/books/{isbn}:
    delete:
      description: Delete book from catalog using 2PC protocol (Manager only)
      parameters:
      - description: Book ISBN
        in: path
        name: isbn
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Book deleted successfully
          schema:
            $ref: '#/definitions/models.SuccessResponse'
        "404":
          description: Book not found
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Failed to delete book
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Delete book from catalog
      tags:
      - Manager
    get:
      description: Get book information from catalog (Manager only)
      parameters:
      - description: Book ISBN
        in: path
        name: isbn
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Book information
          schema:
            $ref: '#/definitions/models.SuccessResponse'
        "404":
          description: Book not found
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Failed to retrieve book
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Get book by ISBN
      tags:
      - Manager
    put:
      consumes:
      - application/json
      description: Update book information using 2PC protocol (Manager only)
      parameters:
      - description: Book ISBN
        in: path
        name: isbn
        required: true
        type: string
      - description: Updated book information
        in: body
        name: book
        required: true
        schema:
          $ref: '#/definitions/models.Sach'
      produces:
      - application/json
      responses:
        "200":
          description: Book updated successfully
          schema:
            $ref: '#/definitions/models.SuccessResponse'
        "400":
          description: Invalid request format
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "404":
          description: Book not found
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Failed to update book
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Update book in catalog
      tags:
      - Manager
  /manager/books/search:
    get:
      description: Search for books across all sites with availability information
        (Manager only)
      parameters:
      - description: Search query
        in: query
        name: query
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Search results with availability
          schema:
            $ref: '#/definitions/models.SuccessResponse'
        "400":
          description: Invalid query
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Search failed
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Search books across all sites
      tags:
      - Manager
  /manager/readers:
    get:
      description: Get readers from all sites with pagination (Manager only)
      parameters:
      - description: Page number (0-based, default 0)
        in: query
        name: page
        type: integer
      - description: Page size (default 20)
        in: query
        name: size
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: List of all readers
          schema:
            $ref: '#/definitions/models.ListResponse'
        "500":
          description: Failed to retrieve readers
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Get all readers across all sites
      tags:
      - Manager
  /manager/statistics:
    get:
      description: Get comprehensive statistics across all sites (Manager only)
      produces:
      - application/json
      responses:
        "200":
          description: System statistics
          schema:
            $ref: '#/definitions/models.SuccessResponse'
        "500":
          description: Failed to retrieve statistics
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Get system-wide statistics
      tags:
      - Manager
  /manager/transfer:
    post:
      consumes:
      - application/json
      description: Transfer a book copy from one site to another using 2PC protocol
      parameters:
      - description: Transfer request
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/models.TransferBookRequest'
      produces:
      - application/json
      responses:
        "200":
          description: Book copy transferred successfully
          schema:
            $ref: '#/definitions/models.SuccessResponse'
        "400":
          description: Invalid request format
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Failed to transfer book copy
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Transfer book copy between sites
      tags:
      - Manager
  /readers:
    get:
      description: 'Get readers with role-based filtering (ThuThu: local site, QuanLy:
        all sites)'
      parameters:
      - description: Page number (0-based, default 0)
        in: query
        name: page
        type: integer
      - description: Page size (default 20)
        in: query
        name: size
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: List of readers
          schema:
            $ref: '#/definitions/models.ListResponse'
        "500":
          description: Failed to retrieve readers
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Get all readers
      tags:
      - Readers
    post:
      consumes:
      - application/json
      description: Create a new reader at the user's site (ThuThu only)
      parameters:
      - description: Reader information
        in: body
        name: reader
        required: true
        schema:
          $ref: '#/definitions/models.DocGia'
      produces:
      - application/json
      responses:
        "201":
          description: Reader created successfully
          schema:
            $ref: '#/definitions/models.SuccessResponse'
        "400":
          description: Invalid request format
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Failed to create reader
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Create new reader
      tags:
      - Readers
  /readers/{maDG}:
    delete:
      description: Delete reader (ThuThu only)
      parameters:
      - description: Reader ID
        in: path
        name: maDG
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Reader deleted successfully
          schema:
            $ref: '#/definitions/models.SuccessResponse'
        "404":
          description: Reader not found
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Failed to delete reader
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Delete reader
      tags:
      - Readers
    get:
      description: Get reader information by ID with role-based access control
      parameters:
      - description: Reader ID
        in: path
        name: maDG
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Reader information
          schema:
            $ref: '#/definitions/models.SuccessResponse'
        "404":
          description: Reader not found
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Failed to retrieve reader
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Get reader by ID
      tags:
      - Readers
    put:
      consumes:
      - application/json
      description: Update reader information (ThuThu only)
      parameters:
      - description: Reader ID
        in: path
        name: maDG
        required: true
        type: string
      - description: Updated reader information
        in: body
        name: reader
        required: true
        schema:
          $ref: '#/definitions/models.DocGia'
      produces:
      - application/json
      responses:
        "200":
          description: Reader updated successfully
          schema:
            $ref: '#/definitions/models.SuccessResponse'
        "400":
          description: Invalid request format
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "404":
          description: Reader not found
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Failed to update reader
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Update reader
      tags:
      - Readers
  /readers/{maDG}/stats:
    get:
      description: Get reader information with borrowing statistics
      parameters:
      - description: Reader ID
        in: path
        name: maDG
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Reader with statistics
          schema:
            $ref: '#/definitions/models.SuccessResponse'
        "404":
          description: Reader not found
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Failed to retrieve reader statistics
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Get reader with statistics
      tags:
      - Readers
  /readers/search:
    get:
      description: Search for readers across sites (role-based access)
      parameters:
      - description: Search query
        in: query
        name: query
        required: true
        type: string
      - description: Page number (0-based, default 0)
        in: query
        name: page
        type: integer
      - description: Page size (default 20)
        in: query
        name: size
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: Search results
          schema:
            $ref: '#/definitions/models.ListResponse'
        "400":
          description: Invalid query
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Search failed
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Search readers
      tags:
      - Readers
  /readers/stats:
    get:
      description: Get all readers with borrowing statistics for the site
      produces:
      - application/json
      responses:
        "200":
          description: Readers with statistics
          schema:
            $ref: '#/definitions/models.SuccessResponse'
        "500":
          description: Failed to retrieve reader statistics
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      summary: Get readers with statistics
      tags:
      - Readers
  /stats/borrow-trends:
    get:
      description: Get borrowing trends for site analysis
      parameters:
      - default: 30
        description: Number of days to analyze
        in: query
        name: days
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: Borrow trends retrieved successfully
          schema:
            $ref: '#/definitions/models.SuccessResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Get borrowing trends
      tags:
      - Statistics
  /stats/distributed:
    get:
      description: Get distributed system health and statistics (Manager only)
      produces:
      - application/json
      responses:
        "200":
          description: Distributed statistics retrieved successfully
          schema:
            $ref: '#/definitions/models.SuccessResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "403":
          description: Access denied - Manager role required
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Get distributed system statistics
      tags:
      - Statistics
  /stats/health:
    get:
      description: Get system health status across all sites
      produces:
      - application/json
      responses:
        "200":
          description: System health retrieved successfully
          schema:
            $ref: '#/definitions/models.SuccessResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Get system health
      tags:
      - Statistics
  /stats/popular-books:
    get:
      description: Get popular books based on borrowing frequency
      parameters:
      - default: 10
        description: Number of books to return
        in: query
        name: limit
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: Popular books statistics retrieved successfully
          schema:
            $ref: '#/definitions/models.SuccessResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Get popular books statistics
      tags:
      - Statistics
  /stats/readers:
    get:
      description: Get readers with borrowing statistics with pagination (enhanced
        for Flutter app)
      parameters:
      - default: 0
        description: Page number (0-based)
        in: query
        name: page
        type: integer
      - default: 20
        description: Items per page
        in: query
        name: size
        type: integer
      - description: Search term for reader name or ID
        in: query
        name: search
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Readers with stats retrieved successfully
          schema:
            $ref: '#/definitions/models.ListResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Get readers with statistics and pagination
      tags:
      - Statistics
  /stats/site:
    get:
      description: Get statistics for current site (available to both roles)
      produces:
      - application/json
      responses:
        "200":
          description: Site statistics retrieved successfully
          schema:
            $ref: '#/definitions/models.SuccessResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Get site statistics
      tags:
      - Statistics
  /stats/system:
    get:
      description: Get comprehensive system statistics across all sites (Manager only)
      produces:
      - application/json
      responses:
        "200":
          description: System statistics retrieved successfully
          schema:
            $ref: '#/definitions/models.SystemStatsResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "403":
          description: Access denied - Manager role required
          schema:
            $ref: '#/definitions/models.ErrorResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/models.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Get system statistics
      tags:
      - Statistics
schemes:
- http
- https
swagger: "2.0"
